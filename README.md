# Slack ç§æœ‰é¢‘é“å½’æ¡£å·¥å…·

<div align="center">

[![Node.js Version](https://img.shields.io/badge/Node-%3E%3D18.17.0-brightgreen)](https://nodejs.org/)
[![Express](https://img.shields.io/badge/Express-4.x-blue.svg)](https://expressjs.com/)
[![JavaScript](https://img.shields.io/badge/JavaScript-ES6+-yellow.svg)](https://developer.mozilla.org/en-US/docs/Web/JavaScript)
[![CSS3](https://img.shields.io/badge/CSS3-3.x-1572B6.svg)](https://developer.mozilla.org/en-US/docs/Web/CSS)
[![Slack API](https://img.shields.io/badge/Slack%20API-Web%20API-orange.svg)](https://api.slack.com/)

[![English](https://img.shields.io/badge/Language-English-blue?style=for-the-badge)](README_EN.md)
[![ä¸­æ–‡](https://img.shields.io/badge/Language-ä¸­æ–‡-green?style=for-the-badge)](README.md)

</div>

Slack Private Channel å½’æ¡£å·¥å…·ï¼Œå¸®åŠ©ç”¨æˆ·å®‰å…¨åœ°å½’æ¡£ Slack ç§æœ‰é¢‘é“ã€‚è¯¥å·¥å…·æä¾›æ”¯æŒ OAuth æˆæƒã€é¢‘é“åˆ—è¡¨æŸ¥çœ‹ã€æ‰¹é‡é€‰æ‹©å’Œå½’æ¡£æ“ä½œã€‚

## é»˜è®¤é…ç½®è¯´æ˜

**å½“å‰é»˜è®¤ç‰ˆæœ¬ä¸ºå½’æ¡£ Private Channel ä¸”åˆ—è¡¨ä»…è¿‡æ»¤å‡ºæˆæƒè€…åˆ›å»ºçš„ channelï¼Œå…·ä½“éœ€è¦æ“ä½œç§æœ‰é¢‘é“æˆ–å…¬å…±é¢‘é“ï¼Œå¯æ ¹æ®éœ€æ±‚è‡ªå·±é…ç½®ã€‚**

> ğŸ’¡ **é…ç½®æç¤º**ï¼šå¦‚éœ€ä¿®æ”¹é¢‘é“ç±»å‹æˆ–è¿‡æ»¤æ¡ä»¶ï¼Œè¯·å‚è€ƒ [é…ç½®è¯´æ˜æ–‡æ¡£](CONFIGURATION.md) è¿›è¡Œè‡ªå®šä¹‰è®¾ç½®ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” **å®‰å…¨çš„ OAuth æˆæƒ** - ä½¿ç”¨ Slack OAuth 2.0 æµç¨‹ï¼Œæ— éœ€æ‰‹åŠ¨è¾“å…¥ token
- ğŸ“‹ **é¢‘é“åˆ—è¡¨ç®¡ç†** - æ˜¾ç¤ºæ‰€æœ‰ç§æœ‰é¢‘é“ï¼ŒåŒ…å«æˆå‘˜æ•°é‡ã€åˆ›å»ºæ—¶é—´ç­‰ä¿¡æ¯ã€ï¼ˆå¯é…ç½® public channelï¼Œä½†æ—¥å¸¸ public channel å¯é€šè¿‡ bot token è¿›è¡Œç®¡ç†ï¼‰
- âœ… **æ‰¹é‡é€‰æ‹©** - æ”¯æŒå…¨é€‰/å–æ¶ˆå…¨é€‰ï¼Œæ–¹ä¾¿æ‰¹é‡æ“ä½œ
- ğŸ—„ï¸ **ä¸€é”®å½’æ¡£** - å®‰å…¨åœ°å½’æ¡£é€‰ä¸­çš„é¢‘é“
- ğŸ“Š **æ“ä½œç»“æœåé¦ˆ** - è¯¦ç»†çš„æˆåŠŸ/å¤±è´¥ç»“æœå±•ç¤º
- ğŸ¨ **UI** - å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯è®¿é—®
- âš¡ **å®æ—¶çŠ¶æ€** - æ˜¾ç¤ºé¢‘é“çŠ¶æ€ï¼ˆæ´»è·ƒ/å·²å½’æ¡£ï¼‰

## é¡µé¢å±•ç¤º

### ä¸»é¡µé¢
![ä¸»é¡µé¢ç¬¬ä¸‰ç‰ˆ](screenshots/index_third_version.png)
**å½“å‰ç‰ˆæœ¬** - é‡‡ç”¨Slackå“ç‰Œé…è‰²æ–¹æ¡ˆï¼Œç™½è‰²èƒŒæ™¯é…åˆç´«è‰²æ¸å˜å¤´éƒ¨ã€‚

![ä¸»é¡µé¢ç¬¬äºŒç‰ˆ](screenshots/index_second_version.png)
![ä¸»é¡µé¢ç¬¬ä¸€ç‰ˆ](screenshots/index_first_version.png)
åº”ç”¨çš„ä¸»é¡µé¢ï¼Œæä¾›Slackæˆæƒå…¥å£å’ŒåŠŸèƒ½ä»‹ç»ã€‚

### é¢‘é“åˆ—è¡¨
![é¢‘é“åˆ—è¡¨](screenshots/channel_lists.png)
æ˜¾ç¤ºæ‰€æœ‰å¯å½’æ¡£çš„ç§æœ‰é¢‘é“ï¼Œæ”¯æŒæ‰¹é‡é€‰æ‹©å’ŒæŸ¥çœ‹é¢‘é“è¯¦ç»†ä¿¡æ¯ã€‚

### ç¡®è®¤å½’æ¡£
![ç¡®è®¤å½’æ¡£](screenshots/confirm_archive.png)
å½’æ¡£æ“ä½œå‰çš„ç¡®è®¤é¡µé¢ï¼Œæ˜¾ç¤ºé€‰ä¸­çš„é¢‘é“åˆ—è¡¨ä¾›ç”¨æˆ·æœ€ç»ˆç¡®è®¤ã€‚

### å½’æ¡£ç»“æœ
![å½’æ¡£ç»“æœ](screenshots/after_archive.png)
å½’æ¡£æ“ä½œå®Œæˆåçš„ç»“æœå±•ç¤ºï¼ŒåŒ…å«æˆåŠŸ/å¤±è´¥ç»Ÿè®¡å’Œè¯¦ç»†ç»“æœã€‚

## æŠ€æœ¯æ ˆ

- **åç«¯**: Node.js + Express
- **å‰ç«¯**: åŸç”Ÿ JavaScript + CSS3
- **API**: Slack Web API
- **æ ·å¼**: CSS + Font Awesome å›¾æ ‡

## ç¯å¢ƒè¦æ±‚

- **Node.js**: >= 18.17.0
- **npm**: >= 8.0.0

## å®‰è£…å’Œé…ç½®

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd slack-channel-archive-tool
```

### 2. å®‰è£…ä¾èµ–

**ç¡®ä¿æ‚¨ä½¿ç”¨çš„æ˜¯æ”¯æŒçš„ Node.js ç‰ˆæœ¬**ï¼š

```bash
# æ£€æŸ¥ Node.js ç‰ˆæœ¬
node --version  # åº”è¯¥æ˜¾ç¤º v18.17.0 æˆ–æ›´é«˜ç‰ˆæœ¬

# å®‰è£…ä¾èµ–
npm install
```

### 3. é…ç½® Slack App

1. è®¿é—® [Slack API ç½‘ç«™](https://api.slack.com/apps)
2. ç‚¹å‡» "Create New App" â†’ "From scratch"
3. è¾“å…¥åº”ç”¨åç§°å’Œé€‰æ‹©å·¥ä½œåŒº
4. åœ¨ "OAuth & Permissions" é¡µé¢é…ç½®ï¼š
   - **Redirect URLs**: `https://localhost:3000/auth/callback` âš ï¸ **å¿…é¡»ä½¿ç”¨ HTTPS**
   - **Scopes**: æ·»åŠ ä»¥ä¸‹æƒé™
     - `channels:read` - è¯»å–å…¬å¼€é¢‘é“ä¿¡æ¯
     - `groups:read` - è¯»å–ç§æœ‰é¢‘é“ä¿¡æ¯
     - `channels:write` - ç®¡ç†å…¬å¼€é¢‘é“
     - `groups:write` - ç®¡ç†ç§æœ‰é¢‘é“

**é‡è¦**: Slack OAuth 2.0 å¼ºåˆ¶è¦æ±‚å›è°ƒ URL å¿…é¡»æ˜¯ HTTPS åè®®ã€‚

### 4. é…ç½®ç¯å¢ƒå˜é‡

#### æœ¬åœ°å¼€å‘ç¯å¢ƒ
å¤åˆ¶ `env.local.example` æ–‡ä»¶ä¸º `.env`ï¼š

```bash
cp env.local.example .env
```

#### ç”Ÿäº§ç¯å¢ƒ
å¤åˆ¶ `env.example` æ–‡ä»¶ä¸º `.env`ï¼š

```bash
cp env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥æ‚¨çš„ Slack App é…ç½®ï¼š

**æœ¬åœ°å¼€å‘é…ç½®**ï¼š
```env
# Slack App é…ç½®
SLACK_CLIENT_ID=your_slack_client_id
SLACK_CLIENT_SECRET=your_slack_client_secret
SLACK_REDIRECT_URI=https://localhost:3000/auth/callback

# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=development
USE_HTTPS=true

# åŠ å¯†é…ç½®ï¼ˆå¯é€‰ï¼Œä¸è®¾ç½®ä¼šè‡ªåŠ¨ç”Ÿæˆï¼‰
# ENCRYPTION_KEY=your_32_byte_encryption_key
```

**ç”Ÿäº§ç¯å¢ƒé…ç½®**ï¼š
```env
# Slack App é…ç½®
SLACK_CLIENT_ID=your_slack_client_id
SLACK_CLIENT_SECRET=your_slack_client_secret
SLACK_REDIRECT_URI=https://your-domain.com/auth/callback

# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=production
USE_HTTPS=false

# åŠ å¯†é…ç½®ï¼ˆå»ºè®®è®¾ç½®ï¼Œæé«˜å®‰å…¨æ€§ï¼‰
ENCRYPTION_KEY=your_32_byte_encryption_key
```

**æ³¨æ„**: 
- æœ¬åœ°å¼€å‘æ—¶ `SLACK_REDIRECT_URI` ä½¿ç”¨ `https://localhost:3000/auth/callback`
- ç”Ÿäº§ç¯å¢ƒæ—¶ `SLACK_REDIRECT_URI` ä½¿ç”¨æ‚¨çš„å®é™…åŸŸå
- `USE_HTTPS` åœ¨æœ¬åœ°å¼€å‘æ—¶è®¾ä¸º `true`ï¼Œç”Ÿäº§ç¯å¢ƒæ—¶è®¾ä¸º `false`

### 5. é…ç½® SSL è¯ä¹¦ï¼ˆä»…æœ¬åœ°å¼€å‘éœ€è¦ï¼‰

**æœ¬åœ°å¼€å‘ç¯å¢ƒ**ï¼šç”±äº Slack OAuth 2.0 å¼ºåˆ¶è¦æ±‚ HTTPS å›è°ƒï¼Œæ‚¨éœ€è¦ç”Ÿæˆæœ¬åœ° SSL è¯ä¹¦ï¼š

```bash
# ç”Ÿæˆè‡ªç­¾åè¯ä¹¦
openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes
```

**ç”Ÿäº§ç¯å¢ƒ**ï¼šå¦‚æœä½¿ç”¨ Cloudflare ç­‰ä»£ç†æœåŠ¡ï¼Œæ— éœ€ç”Ÿæˆæœ¬åœ°è¯ä¹¦ï¼Œè®¾ç½® `USE_HTTPS=false` å³å¯ã€‚

**æ³¨æ„**: 
- ç”Ÿæˆçš„ `key.pem` å’Œ `cert.pem` æ–‡ä»¶å·²è¢« `.gitignore` å¿½ç•¥ï¼Œä¸ä¼šä¸Šä¼ åˆ°ç‰ˆæœ¬æ§åˆ¶
- æœ¬åœ°å¼€å‘æ—¶è¿™æ˜¯å¿…è¦æ­¥éª¤ï¼Œç”Ÿäº§ç¯å¢ƒç”±ä»£ç†æœåŠ¡å¤„ç† HTTPS

### 6. å¯åŠ¨åº”ç”¨

```bash
# å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡å¯ï¼‰
npm run dev

# ç”Ÿäº§æ¨¡å¼
npm start
```

è®¿é—® `https://localhost:3000` å¼€å§‹ä½¿ç”¨ã€‚

**æ³¨æ„**: æµè§ˆå™¨å¯èƒ½ä¼šæ˜¾ç¤ºå®‰å…¨è­¦å‘Šï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯è‡ªç­¾åè¯ä¹¦ã€‚ç‚¹å‡»"é«˜çº§"â†’"ç»§ç»­è®¿é—®"å³å¯ã€‚

## ä½¿ç”¨è¯´æ˜

### 1. æˆæƒè®¿é—®
- ç‚¹å‡» "æˆæƒ Slack è®¿é—®" æŒ‰é’®
- åœ¨ Slack æˆæƒé¡µé¢ç¡®è®¤æƒé™
- æˆæƒæˆåŠŸåè‡ªåŠ¨è¿”å›åº”ç”¨

### 2. é€‰æ‹©é¢‘é“
- æŸ¥çœ‹æ‰€æœ‰ç§æœ‰é¢‘é“åˆ—è¡¨
- ä½¿ç”¨å¤é€‰æ¡†é€‰æ‹©è¦å½’æ¡£çš„é¢‘é“
- æ”¯æŒå…¨é€‰/å–æ¶ˆå…¨é€‰æ“ä½œ
- å¯ä»¥åˆ·æ–°åˆ—è¡¨è·å–æœ€æ–°æ•°æ®

### 3. ç¡®è®¤å½’æ¡£
- æŸ¥çœ‹é€‰ä¸­çš„é¢‘é“åˆ—è¡¨
- ç¡®è®¤æ“ä½œï¼ˆä¸å¯é€†ï¼‰
- ç‚¹å‡» "ç¡®è®¤å½’æ¡£" æ‰§è¡Œæ“ä½œ

### 4. æŸ¥çœ‹ç»“æœ
- æ˜¾ç¤ºå½’æ¡£æˆåŠŸ/å¤±è´¥ç»Ÿè®¡
- è¯¦ç»†çš„æ¯ä¸ªé¢‘é“æ“ä½œç»“æœ
- å¯ä»¥å¼€å§‹æ–°çš„å½’æ¡£ä¼šè¯

## API ç«¯ç‚¹

### è®¤è¯ç›¸å…³
- `GET /auth` - å¯åŠ¨ OAuth æˆæƒæµç¨‹
- `GET /auth/callback` - OAuth å›è°ƒå¤„ç†

### é¢‘é“ç®¡ç†
- `GET /api/channels?token_id=<id>` - è·å–ç§æœ‰é¢‘é“åˆ—è¡¨
- `POST /api/archive` - å½’æ¡£é€‰ä¸­çš„é¢‘é“

### è°ƒè¯•ç«¯ç‚¹ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰
- `GET /debug/token/:tokenId` - æŸ¥çœ‹TokenåŸºæœ¬ä¿¡æ¯ï¼ˆä¸æš´éœ²æ•æ„Ÿæ•°æ®ï¼‰

## å®‰å…¨è€ƒè™‘

- ä½¿ç”¨ OAuth 2.0 æµç¨‹ï¼Œæ— éœ€å­˜å‚¨ç”¨æˆ·å¯†ç 
- Token åŠ å¯†å­˜å‚¨ï¼Œ5åˆ†é’Ÿåè‡ªåŠ¨è¿‡æœŸ
- å®šæœŸæ¸…ç†è¿‡æœŸçš„ token
- æ‰€æœ‰ API è°ƒç”¨éƒ½ç»è¿‡éªŒè¯
- è°ƒè¯•ç«¯ç‚¹ä»…åœ¨å¼€å‘ç¯å¢ƒå¯ç”¨
- æ•æ„Ÿä¿¡æ¯ä¸ä¼šåœ¨æ—¥å¿—ä¸­æš´éœ²

## å¼€å‘è¯´æ˜

### é¡¹ç›®ç»“æ„
```
slack-channel-archive-tool/
â”œâ”€â”€ server.js              # Express HTTPS æœåŠ¡å™¨
â”œâ”€â”€ package.json           # é¡¹ç›®é…ç½®
â”œâ”€â”€ package-lock.json      # ä¾èµ–é”å®šæ–‡ä»¶
â”œâ”€â”€ .gitignore             # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ env.example            # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ env.local.example      # æœ¬åœ°ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ README.md              # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ README_EN.md           # è‹±æ–‡æ–‡æ¡£
â”œâ”€â”€ QUICKSTART.md          # å¿«é€Ÿå¼€å§‹æŒ‡å—
â”œâ”€â”€ QUICKSTART_EN.md       # è‹±æ–‡å¿«é€Ÿå¼€å§‹æŒ‡å—
â”œâ”€â”€ CONFIGURATION.md       # é…ç½®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ DEPLOYMENT.md          # éƒ¨ç½²è¯´æ˜
â”œâ”€â”€ LICENSE                # è®¸å¯è¯æ–‡ä»¶
â”œâ”€â”€ screenshots/           # é¡µé¢æˆªå›¾
â””â”€â”€ public/                # é™æ€æ–‡ä»¶
    â”œâ”€â”€ index.html         # ä¸»é¡µé¢
    â”œâ”€â”€ styles.css         # æ ·å¼æ–‡ä»¶
    â””â”€â”€ script.js          # å‰ç«¯é€»è¾‘
```

### é‡è¦æ–‡ä»¶è¯´æ˜

- **`.env`**: ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆä¸æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ï¼‰
- **`key.pem` & `cert.pem`**: SSL è¯ä¹¦æ–‡ä»¶ï¼ˆä¸æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ï¼‰
- **`node_modules/`**: ä¾èµ–åŒ…ç›®å½•ï¼ˆä¸æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ï¼‰

### è‡ªå®šä¹‰é…ç½®

#### ä¿®æ”¹ç«¯å£
ç¼–è¾‘ `.env` æ–‡ä»¶ä¸­çš„ `PORT` å˜é‡ã€‚

#### ä¿®æ”¹ OAuth é‡å®šå‘ URL
1. æ›´æ–° `.env` æ–‡ä»¶ä¸­çš„ `SLACK_REDIRECT_URI`
2. åœ¨ Slack App è®¾ç½®ä¸­æ›´æ–°å¯¹åº”çš„é‡å®šå‘ URL

#### è‡ªå®šä¹‰æ ·å¼
ç¼–è¾‘ `public/styles.css` æ–‡ä»¶æ¥è‡ªå®šä¹‰ç•Œé¢æ ·å¼ã€‚

#### é¢‘é“ç±»å‹é…ç½®
å½“å‰é»˜è®¤é…ç½®ä¸ºä»…æ˜¾ç¤ºç§æœ‰é¢‘é“ä¸”ä»…æ˜¾ç¤ºæˆæƒè€…åˆ›å»ºçš„é¢‘é“ã€‚å¦‚éœ€è°ƒæ•´ï¼Œå¯ä¿®æ”¹ `server.js` ä¸­çš„ç›¸å…³é…ç½®ï¼š

**è·å–é¢‘é“åˆ—è¡¨çš„é…ç½®**ï¼ˆç¬¬ 150-160 è¡Œå·¦å³ï¼‰ï¼š
```javascript
// è·å–ç§æœ‰é¢‘é“åˆ—è¡¨
const channelsResponse = await axios.get('https://slack.com/api/conversations.list', {
  headers: {
    'Authorization': `Bearer ${decryptedToken}`
  },
  params: {
    types: 'private_channel',  // å¯æ”¹ä¸º 'public_channel' æˆ– 'private_channel,public_channel'
    exclude_archived: true
  }
});

// è¿‡æ»¤é¢‘é“ï¼ˆç¬¬ 170-175 è¡Œå·¦å³ï¼‰
const filteredChannels = channelsResponse.data.channels.filter(channel => {
  return channel.creator === currentUserId;  // ç§»é™¤æ­¤æ¡ä»¶å¯æ˜¾ç¤ºæ‰€æœ‰é¢‘é“
});
```

**é…ç½®é€‰é¡¹è¯´æ˜**ï¼š
- `types: 'private_channel'` - ä»…ç§æœ‰é¢‘é“
- `types: 'public_channel'` - ä»…å…¬å…±é¢‘é“  
- `types: 'private_channel,public_channel'` - ç§æœ‰å’Œå…¬å…±é¢‘é“
- `channel.creator === currentUserId` - ä»…æ˜¾ç¤ºå½“å‰ç”¨æˆ·åˆ›å»ºçš„é¢‘é“
- ç§»é™¤è¿‡æ»¤æ¡ä»¶ - æ˜¾ç¤ºæ‰€æœ‰é¢‘é“

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Node.js ç‰ˆæœ¬é—®é¢˜**
   - ç¡®ä¿ä½¿ç”¨ Node.js 18.17.0 æˆ–æ›´é«˜ç‰ˆæœ¬
   - å¦‚æœé‡åˆ° npm è¯­æ³•é”™è¯¯ï¼Œè¯·å‡çº§ Node.js ç‰ˆæœ¬
   - ä½¿ç”¨ `node --version` æ£€æŸ¥å½“å‰ç‰ˆæœ¬

2. **OAuth æˆæƒå¤±è´¥**
   - æ£€æŸ¥ Slack App é…ç½®æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤é‡å®šå‘ URL åŒ¹é…
   - éªŒè¯ Client ID å’Œ Secret

3. **æ— æ³•è·å–é¢‘é“åˆ—è¡¨**
   - ç¡®è®¤ App æœ‰æ­£ç¡®çš„æƒé™èŒƒå›´
   - æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®ç§æœ‰é¢‘é“çš„æƒé™

4. **å½’æ¡£æ“ä½œå¤±è´¥**
   - ç¡®è®¤ç”¨æˆ·æœ‰å½’æ¡£é¢‘é“çš„æƒé™
   - æ£€æŸ¥é¢‘é“æ˜¯å¦å·²ç»è¢«å½’æ¡£

### è°ƒè¯•æ¨¡å¼

å¯åŠ¨æ—¶æ·»åŠ è°ƒè¯•ä¿¡æ¯ï¼š

```bash
DEBUG=* npm start
```

## è®¸å¯è¯

MIT License